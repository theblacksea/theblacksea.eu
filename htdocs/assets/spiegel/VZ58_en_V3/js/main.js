var

    light_color                 = 0xffffff,
    light_strength              = 0.7,
    scene_background_color      = 0xffffff,
    scene_background_opacity    = 1,
    fallback_image              = "img/fallback.jpg",
    start_position              = [-2,1,2],
    min_polar_angle             = 0,
    max_polar_angle             = 180,
    min_azimuth_angle           = -3.1,
    max_azimuth_angle           = 0,
    auto_rotate                 = false,
    no_zoom                     = false,
    search_key,
    top_info,
    top_infos,
    key_frame_animation         = true,
    model_scale                 = 0.2,
    zoom_min_distance           = 333,
    zoom_max_distance           = 550,
    camera_controls             = true,
    model_url                   = "AK_Animation.dae";


!function(){function t(){var t,n,e,a,i,s=document.createElement("div");if(document.body.appendChild(s),w=$("body"),y=new THREE.Clock,top_info&&top_info.length>10&&w.append($("<div/>",{"class":"top_info",html:top_info})),b=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,.01,1e3),h=new THREE.Scene,key_frame_animation)for(i=0;E>i;++i)A=x[i],C=new THREE.KeyFrameAnimation(A),C.timeScale=1,L.push(C);if(search_key)for(t=0,n=v.children.length;n>t;)e=v.children[t],e.transparent=!0,e.opacity=.5,e.name.indexOf(search_key)>=0&&(q.push(e),a=$("<div/>",{"class":"info",html:marker_texte[N]}),detail_infos&&detail_infos[N]&&detail_infos[N].length>4&&(a.addClass("detail"),a.data("open","false"),a.data("normal",marker_texte[N]),a.data("detail",detail_infos[N]),a.click(function(){$(".oben").each(function(){$(this).removeClass("oben"),$(this).html($(this).data("normal"))}),"false"===$(this).data("open")?($(this).html($(this).data("detail")),$(this).addClass("oben"),$(this).data("open","true")):($(this).html($(this).data("normal")),$(this).removeClass("oben"),$(this).data("open","false"))})),N++,w.append(a),F.push(a)),t++;return h.add(v),start_position?b.position.set(start_position[0],start_position[1],start_position[2]):b.position.set(2,2,2),b.lookAt(v.position),b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix(),m=new THREE.PointLight(light_color,light_strength),h.add(m),Detector.webgl?(g=$(window).width()>500?new THREE.WebGLRenderer({antialias:!0}):new THREE.WebGLRenderer({antialias:!1}),g.setSize(window.innerWidth,window.innerHeight),g.setClearColor(scene_background_color,scene_background_opacity),s.appendChild(g.domElement),window.addEventListener("resize",p,!1),camera_controls&&(T=new THREE.OrbitControls(b,g.domElement),T.minDistance=zoom_min_distance,T.maxDistance=zoom_max_distance,T.minPolarAngle=min_polar_angle,T.maxPolarAngle=max_polar_angle,T.minAzimuthAngle=min_azimuth_angle,T.maxAzimuthAngle=max_azimuth_angle,auto_rotate&&(T.autoRotate=!0),no_zoom&&(T.noZoom=!0)),F.length>0&&(u(),_()),$(".info").click(function(){l(q[0],!1)}),void $(".detail_text").html(intro_text)):(I=!0,delete h,delete v,delete g,delete b,delete o,o=function(){},$(".info").remove(),$(".top_info").remove(),void r())}function n(t){var n,e,o,i,s,r,c,d,l,u;for(E>0&&a(!0),S&&(a(!1),S=!1),t&&(j=t),0===j||j||(j=W),0===t&&(j=0),n=0;E>n;++n){for(l=L[n],e=0,u=l.hierarchy.length;u>e;e++)if(i=l.data.hierarchy[e].keys,s=l.data.hierarchy[e].sids,c=l.hierarchy[e],i.length&&s){for(o=0;o<s.length;o++)r=s[o],d=l.getNextKeyWith(r,e,0),d&&d.apply(r);c.matrixAutoUpdate=!1,l.data.hierarchy[e].node.updateMatrix(),c.matrixWorldNeedsUpdate=!0}l.loop=!1,k=0,l.play(j),R=Date.now()}}function e(t){var n;for(n=0;E>n;++n)L[n].update(t)}function o(){var t=Number(k.toString().substr(0,5));key_frame_animation&&(t==D&&(z=!1),z&&1>=k?(e(k),k+=.001):a(!1)),m.position.copy(b.position),g.render(h,b),requestAnimationFrame(o),camera_controls&&T.update()}function a(t){var n=$(".btn_play");z=t,z?n.text("stop"):n.text("play")}function i(t){var e,o=$(t.currentTarget),a=o.data("obi");e=!1,z||(e=!0),$(".active_button").removeClass("active_button"),o.addClass("active_button"),K=a.id,D=a.length,$(".detail_text").html(a.detail),f(),n(a.time)}function s(t){var e=$(t.currentTarget);$(".btn_prev").css({opacity:"1",cursor:"pointer"}),$(".btn_next").css({opacity:"1",cursor:"pointer"}),e.hasClass("btn_next")?K<real_buttons.length-1&&(K++,$(".buttons").find(".button:eq("+K+")").click()):K>0?(K--,$(".buttons").find(".button:eq("+K+")").click()):(z=!1,n(0),f(),$(".detail_text").html(intro_text),0===K&&K--,$(".btn_prev").css({opacity:"0.3",cursor:"auto"}),I&&P.css({"background-image":"url(img/step_0.jpg)",height:$(window).height()})),K===real_buttons.length-1&&$(".btn_next").css({opacity:"0.3",cursor:"auto"})}function r(){P=$("<div/>",{"class":"fallimg"}),$("body").prepend(P),n=function(){P.css({"background-image":"url(img/step_"+(K+1)+".jpg)",height:$(window).height()})},f=function(){},$(".detail_text").html(intro_text),$(".btn_prev").css({opacity:"0.3",cursor:"auto"})}function c(){var t,e,o,r,c,d,l=$("<div/>",{"class":"buttons"});if(real_buttons){for(e=0,o=real_buttons.length;o>e;)real_buttons[e].id=e,t=$("<div/>",{"class":"button",html:real_buttons[e].text}),t.data("obi",real_buttons[e]),t.click(i),l.append(t),e++;d=$("<div/>",{"class":"pager"}),r=$("<div/>",{"class":"btn_next",html:"  "}),c=$("<div/>",{"class":"btn_prev",html:"  "}),r.click(s),c.click(s),d.append(c,r),$("body").append(d),$(".btn_prev").css({opacity:"0.3",cursor:"auto"})}t=$("<div/>",{"class":"button btn_play",html:"stop",css:{"margin-left":"20px"}}),t.click(function(){f(),z?a(!1):(a(!0),n())}),l.append(t),t.hide(),$("body").append(l,$("<div/>",{"class":"debug"}))}function d(t,n){var e=new THREE.Vector3,o=.5*g.context.canvas.width,a=.5*g.context.canvas.height;return t.updateMatrixWorld(),e.setFromMatrixPosition(t.matrixWorld),e.project(n),e.x=e.x*o+o,e.y=-(e.y*a)+a,{x:e.x,y:e.y}}function l(t,n){t.visible=n}function u(){clearInterval(H);for(var t,n,e=0,o=q.length;o>e;)t=q[e],n=d(t,b),F[e].css({top:n.y+"px",left:n.x+"px"}),e++;H=setInterval(u,33)}function p(){b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix(),g.setSize(window.innerWidth,window.innerHeight)}function f(){for(var t=0;E>t;++t)L[t].stop()}function _(){var t,n,e,o,a,i;e=$("<div/>",{"class":"control_btns"}),t=$("<div/>",{"class":"control_btn btn_rotate"}),o=$("<div/>",{"class":"control_label",text:"Auto-Rotation"}),a=$("<div/>",{"class":"on",text:"An"}),a.css("background","none"),i=$("<div/>",{"class":"off",text:"Aus"}),t.append(o,[i,a]),e.append(t),t.click(function(){T.autoRotate=!T.autoRotate,T.autoRotate?($(".btn_rotate").find(".on").css("background","#b6d495"),$(".btn_rotate").find(".off").css("background","none")):($(".btn_rotate").find(".on").css("background","none"),$(".btn_rotate").find(".off").css("background","#d29881"))}),n=$("<div/>",{"class":"control_btn btn_infos"}),o=$("<div/>",{"class":"control_label",text:"Texte"}),a=$("<div/>",{"class":"on",text:"An"}),i=$("<div/>",{"class":"off",text:"Aus"}),i.css("background","none"),n.append(o,[i,a]),e.append(n),n.click(function(){G=!G,G?($(".info").show(),$(".btn_infos").find(".on").css("background","#b6d495"),$(".btn_infos").find(".off").css("background","none")):($(".info").hide(),$(".btn_infos").find(".on").css("background","none"),$(".btn_infos").find(".off").css("background","#d29881"))}),$("body").append(e)}var h,m,b,g,v,x,w,y,k,E,R,A,C,H,T,z,W,P,j,D,L=[],M=new THREE.ColladaLoader,S=!0,q=[],F=[],N=0,G=!0,I=!1,K=-1;return console.log=function(){},console.warn=function(){},Detector.webgl?(M.load("models/"+model_url,function(e){v=e.scene,x=e.animations,key_frame_animation&&(E=x.length,v.scale.x=v.scale.y=v.scale.z=model_scale),t(),key_frame_animation&&n(),o(R)}),void c()):void $("body").append($("<img/>",{src:fallback_image,"class":"fallback"}))}();